#!/bin/bash
set -eu
WYGA_VERSION="${WYGA_VERSION:-none}"
if [[ "${WYGA_VERSION}" == "none" ]]
then
	echo "do not run this script directly!"
	exit 1
fi
REGISTRY="${REGISTRY}-merge"
echo "Build base: ${REGISTRY}:${BASE}"
docker build -t "${REGISTRY}:${BASE}" --build-arg WYGA_VERSION=${WYGA_VERSION} -f ../Dockerfile.8.0.base-merge.fpm ../../context/empty/

for _tag in ${BASE_FPM_TAG_AS}
do
	echo "TAG as ${REGISTRY}:${_tag}"
	docker tag "${REGISTRY}:${BASE}" ${REGISTRY}:${_tag}
done

BASE="${BASE}-cli"
echo "Build base: ${REGISTRY}:${BASE}"
docker build -t "${REGISTRY}:${BASE}" --build-arg WYGA_VERSION=${WYGA_VERSION} -f ../Dockerfile.8.0.base-merge.cli ../../context/empty/

for _tag in ${BASE_CLI_TAG_AS}
do
	echo "TAG as ${REGISTRY}:${_tag}"
	docker tag "${REGISTRY}:${BASE}" ${REGISTRY}:${_tag}
done
